<extend name="Public/base" />
<!-- 子导航 -->
<block name="sidebar">
    <include file="sidemenu" />
</block>

<block name="body">
	<div class="main-title cf">
		<h2>
		新增{$model_name} [
		<volist name="rightNav" id="nav">
			<a href="{:U('article/index','cate_id='.$nav['id'])}">{$nav.title}</a>
			<if condition="count($rightNav) gt $i"><i class="ca"></i></if>
		</volist>
		]</h2>
	</div>
	<!-- 标签页导航 -->
	<div class="tab-wrap">
		<ul class="tab-nav nav">
			<li data-tab="tab1" class="current"><a href="javascript:void(0);">基 础</a></li>
			<li data-tab="tab2"><a href="javascript:void(0);">扩 展</a></li>
		</ul>
		<div class="tab-content">
			<form id="form" action="{:U('update')}" method="post" class="form-horizontal">
				<!-- 基础文档模型 -->
				<div class="tab-pane in tab1">
					<div class="form-item cf">
						<label class="item-label">文档标识：<span class="check-tips">请输入文档标识</span></label>
						<div class="controls">
							<input type="text" class="text input-large" name="name">
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">标题：<span class="check-tips">请输入标题</span></label>
						<div class="controls">
							<input type="text" class="text input-large" name="title">
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">简介：<span class="check-tips">请输入简介</span></label>
						<div class="controls">
							<label class="textarea">
								<textarea name="description" class="input-large"></textarea>
							</label>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">推荐位：</label>
						<div class="controls">
							<label class="checkbox"><input type="checkbox" name="position[]" value="1" <if condition="check_document_position($position,1)">checked="checked"</if>>列表推荐</label>
							<label class="checkbox"><input type="checkbox" name="position[]" value="2" <if condition="check_document_position($position,2)">checked="checked"</if>>频道页推荐</label>
							<label class="checkbox"><input type="checkbox" name="position[]" value="4" <if condition="check_document_position($position,4)">checked="checked"</if>>首页推荐</label>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">外链：</label>
						<div class="controls">
							<input type="text" class="text input-large" name="link_id" value="0">
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">可见性：<span class="check-tips">可见性必选</span></label>
						<div class="controls">
							<label class="radio"><input type="radio" name="display" value="0" <eq name="display" value="0">checked="checked"</eq>>不可见</label>
							<label class="radio"><input type="radio" name="display" value="1" <eq name="display" value="1">checked="checked"</eq>>所有人可见</label>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">截止时间：</label>
						<div class="controls">
							<input type="text" class="text input-large" name="dateline" value="0">
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">封面图片：</label>
						<div class="controls">
							<input type="file" id="upload_picture">
							<input type="hidden" id="cover_id" name="cover_id" value="{$cover_id}"/>
							<span class="check-tips">{$file_id.name}</span>
						</div>
					</div>
				</div>

				<!-- 引入扩展文档模型 -->
				<div class="tab-pane tab2">
					<include file="$template"/>
				</div>

				<div class="form-item cf">
					<label class="item-label"></label>
					<div class="controls">
						<input type="hidden" name="pid" value="0">
			            <input type="hidden" name="type" value="2">
			            <input type="hidden" name="category_id" value="{$cate_id}">
			            <input type="hidden" name="model_id" value="{$model_id}">
						<a class="btn hidden" id="submit" href="javascript:;">保 存</a>
						<a class="btn" id="submit-next" href="javascript:;">下一步</a>
						<a class="btn" href="{:U('article/index?cate_id='.$cate_id)}">返 回</a>
					</div>
				</div>
			</form>
		</div>
	</div>
</block>

<block name="script">
<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
<script type="text/javascript">
$('#submit').click(function(){
	$('#form').submit();
});

(function($){
	//上传附件
	/* 初始化上传插件 */
	$("#download-file").uploadify({
        "height"          : 30,
        "swf"             : "__STATIC__/uploadify/uploadify.swf",
        "fileObjName"     : "download",
        "uploader"        : "{:U('File/upload',array('session_id'=>session_id()))}",
        "width"           : 120,
        "onUploadSuccess" : uploadSuccess
    });
	/* 文件上传成功回调函数 */
    function uploadSuccess(file, data){
    	var data = $.parseJSON(data);
        if(data.status){
        	$("#cover_id").val(data.id);
        	$("#upload_picture").parent().find('.check-tips').html('<img src="' + data.path + '"/>');
        } else {
        	alert(data.info);
        }
    }

	//上传图片
    /* 初始化上传插件 */
	$("#upload_picture").uploadify({
        "height"          : 30,
        "swf"             : "__STATIC__/uploadify/uploadify.swf",
        "fileObjName"     : "download",
        "uploader"        : "{:U('File/uploadPicture',array('session_id'=>session_id()))}",
        "width"           : 120,
        "onUploadSuccess" : uploadPicture
    });
	function uploadPicture(file, data){
    	var data = $.parseJSON(data);
        if(data.status){
        	$("#cover_id").val(data.id);
        	$("#cover_id").parent().find('.check-tips').html('<img src="' + data.path + '"/>');
        } else {
        	alert(data.info);
        }
    }
})(jQuery);

$(function(){
	//初始化通过锚点判断显示哪个标签页
	var last = $(".tab-nav li:last");
	$(".tab-nav li").click(function(){
		var self = $(this), target = self.data("tab");
		self.addClass("current").siblings(".current").removeClass("current");
		window.location.hash = "#" + target.substr(3);
		$(".tab-pane.in").removeClass("in");
		$("." + target).addClass("in");
		showBtn();
	}).filter("[data-tab=tab" + window.location.hash.substr(1) + "]").click();

	$("#submit-next").click(function(){
		$(".tab-nav li.current").next().click();
		showBtn();
	});

	function showBtn() {
		if( last.hasClass("current") ) {
			$("#submit").removeClass("hidden");
			$("#submit-next").addClass("hidden");
		} else {
			$("#submit").addClass("hidden");
			$("#submit-next").removeClass("hidden");
		}
	}
});
</script>
</block>