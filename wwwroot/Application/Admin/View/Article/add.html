<extend name="Public/base" />
<!-- 子导航 -->
<block name="sidebar">
    <div id="subnav" class="subnav">
        <volist name="nodes" id="sub_menu">
            <!-- 子导航 -->
            <notempty name="sub_menu">
                <h3><i class="icon-s1"></i>{$sub_menu.title}</h3>
                <ul>
                    <volist name="sub_menu['_child']" id="menu">
                        <li><a href="{$menu.url|U}">{$menu.title}</a></li>
                    </volist>
                </ul>
            </notempty>
            <!-- /子导航 -->
        </volist>
    </div>
</block>
<!-- /子导航 -->

<block name="body">
	<!-- 标签页导航 -->
	<div class="tab-wrap">
		<ul class="tab-nav nav">
			<li><a data-tab="tab" href="#tag1">基础文档模型</a></li>
			<li><a data-tab="tab" href="#tag2">扩展文档模型</a></li>
		</ul>
		<div class="tab-content">
			<form id="form" action="{:U('update')}" method="post" class="form-horizontal">
				<!-- 基础文档模型 -->
				<div id="tag1" class="tab-pane in">
					<div class="form-item cf">
						<label class="item-label">文档标识：</label>
						<div class="controls">
							<input type="text" class="text" name="name">
							<span class="check-tips">请输入文档标识</span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">标题：</label>
						<div class="controls">
							<input type="text" class="text" name="title">
							<span class="check-tips">请输入标题</span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">简介：</label>
						<div class="controls">
							<label class="textarea"><textarea name="description"></textarea></label>
							<span class="check-tips">请输入简介</span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">推荐位：</label>
						<div class="controls">
							<label class="checkbox"><input type="checkbox" name="position[]" value="1" <if condition="check_document_position($position,1)">checked="checked"</if>>列表推荐</label>
							<label class="checkbox"><input type="checkbox" name="position[]" value="2" <if condition="check_document_position($position,2)">checked="checked"</if>>频道页推荐</label>
							<label class="checkbox"><input type="checkbox" name="position[]" value="4" <if condition="check_document_position($position,4)">checked="checked"</if>>首页推荐</label>
							<span class="check-tips"></span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">外链：</label>
						<div class="controls">
							<input type="text" class="text" name="link_id" value="0">
							<span class="check-tips"></span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">可见性：</label>
						<div class="controls">
							<label class="radio"><input type="radio" name="display" value="0" <eq name="display" value="0">checked="checked"</eq>>不可见</label>
							<label class="radio"><input type="radio" name="display" value="1" <eq name="display" value="1">checked="checked"</eq>>所有人可见</label>
							<span class="check-tips">可见性必选</span>
						</div>
					</div>
					<div class="form-item cf">
						<label class="item-label">截止时间：</label>
						<div class="controls">
							<input type="text" class="text" name="dateline" value="0">
							<span class="check-tips"></span>
						</div>
					</div>
				</div>

				<!-- 引入扩展文档模型 -->
				<div id="tag2" class="tab-pane">
					<include file="$template"/>
				</div>

				<div class="form-item cf">
					<label class="item-label"></label>
					<div class="controls">
						<input type="hidden" name="pid" value="0">
			            <input type="hidden" name="type" value="2">
			            <input type="hidden" name="category_id" value="{$cate_id}">
			            <input type="hidden" name="model_id" value="{$model_id}">
						<button class="btn" id="submit"><em>保存</em> </button>
					</div>
				</div>
			</form>
		</div>
	</div>
</block>

<block name="script">
<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
<script type="text/javascript">
$('#submit').click(function(){
	$('#form').submit();
});

(function($){
	/* 初始化上传插件 */
	$("#download-file").uploadify({
        "height"          : 30,
        "swf"             : "__STATIC__/uploadify/uploadify.swf",
        "fileObjName"     : "download",
        "uploader"        : "{:U('File/upload')}",
        "width"           : 120,
        "onUploadSuccess" : uploadSuccess
    });

	/* 文件上传成功回调函数 */
    function uploadSuccess(file, data){
    	var data = $.parseJSON(data);
        if(data.status){
        	$("input[name=file]").val(data.data);
        	$("input[name=file]").parent().find('.check-tips').text(data.info);
        } else {
        	alert(data.info);
        }
    }
})(jQuery);
</script>
</block>