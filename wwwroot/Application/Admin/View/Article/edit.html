<extend name="Public/base" />

<!-- 子导航 -->
<block name="sidebar">
    <include file="sidemenu" />
</block>

<block name="body">
	<div class="main-title cf">
		<h2>
		编辑{$model_id|get_document_model='title'} [
		<volist name="rightNav" id="nav">
		<a href="{:U('article/index','cate_id='.$nav['id'])}">{$nav.title}</a>
		<if condition="count($rightNav) gt $i"><i class="ca"></i></if>
		</volist>
		]
	</div>
	<!-- 标签页导航 -->
<div class="tab-wrap">
	<ul class="tab-nav nav">
		<li data-tab="tab1" class="current"><a href="javascript:void(0);">基础</a></li>
		<li data-tab="tab2"><a href="javascript:void(0);">扩展</a></li>
	</ul>
	<div class="tab-content">
	<!-- 表单 -->
	<form id="form" action="{:U('update')}" method="post" class="form-horizontal">
		<!-- 基础文档模型 -->
		<div id="tab1" class="tab-pane in">
			<div class="form-item cf">
				<label class="item-label">文档标识：</label>
				<div class="controls">
					<input type="text" class="text" name="name" value="{$name}">
					<span class="check-tips">请输入文档标识</span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">标题：</label>
				<div class="controls">
					<input type="text" class="text" name="title" value="{$title}">
					<span class="check-tips">请输入标题</span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">简介：</label>
				<div class="controls">
					<label class="textarea"><textarea name="description">{$description}</textarea></label>
					<span class="check-tips">请输入简介</span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">推荐位：</label>
				<div class="controls">
					<label class="checkbox"><input type="checkbox" name="position[]" value="1" <if condition="check_document_position($position,1)">checked="checked"</if>>列表推荐</label>
					<label class="checkbox"><input type="checkbox" name="position[]" value="2" <if condition="check_document_position($position,2)">checked="checked"</if>>频道页推荐</label>
					<label class="checkbox"><input type="checkbox" name="position[]" value="4" <if condition="check_document_position($position,4)">checked="checked"</if>>首页推荐</label>
					<span class="check-tips"></span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">外链：</label>
				<div class="controls">
					<input type="text" class="text" name="link_id" value="{$link_id}">
					<span class="check-tips"></span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">可见性：</label>
				<div class="controls">
					<label class="radio"><input type="radio" name="display" value="0" <eq name="display" value="0">checked="checked"</eq>>不可见</label>
					<label class="radio"><input type="radio" name="display" value="1" <eq name="display" value="1">checked="checked"</eq>>所有人可见</label>
					<span class="check-tips">可见性必选</span>
				</div>
			</div>
			<div class="form-item cf">
				<label class="item-label">截止时间：</label>
				<div class="controls">
					<input type="text" class="text" name="dateline" value="{$dateline}">
					<span class="check-tips"></span>
				</div>
			</div>
		</div>

		<div id="tab2" class="tab-pane">
			<!-- 引入扩展文档模型 -->
			<include file="$template"/>
		</div>

		<div class="form-item cf">
			<label class="item-label"></label>
			<div class="controls">
				<a class="btn submit-btn" id="submit" href="javascript:;">确定</a>
				<a class="btn btn-xlarge btn-return" href="{:U('article/index?cate_id='.$cate_id)}">返回</a>
				<input type="hidden" name="id" value="{$id}"/>
				<input type="hidden" name="model_id" value="{$model_id}"/>
				<input type="hidden" name="category_id" value="{$category_id}">
			</div>
		</div>
	</form>
	</div>
</div>
</block>

<block name="script">
<script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
<script type="text/javascript">
$('#submit').click(function(){
	$('#form').submit();
});

(function($){
	/* 初始化上传插件 */
	$("#download-file").uploadify({
        "height"          : 30,
        "swf"             : "__STATIC__/uploadify/uploadify.swf",
        "fileObjName"     : "download",
        "uploader"        : "{:U('File/upload',array('session_id'=>session_id()))}",
        "width"           : 120,
        "onUploadSuccess" : uploadSuccess
    });

	/* 文件上传成功回调函数 */
    function uploadSuccess(file, data){
    	var data = $.parseJSON(data);
        if(data.status){
        	$("input[name=file]").val(data.data);
        	$("input[name=file]").parent().find('.check-tips').text(data.info);
        } else {
        	alert(data.info);
        }
    }
})(jQuery);
$(function(){
	//初始化通过锚点判断显示哪个标签页
	var local = location.hash.split("#", 2)[1];
	if(local == 'tab2'){
		$(".tab-nav li").removeClass('current');
		$(".tab-nav li:last").addClass('current');
		$("#tab1,#tab2").attr("class", "tab-pane");
		$("#tab2").attr("class", "tab-pane in");
	}
	$(".tab-nav li").click(function(){
		var id = $(this).data("tab");
		$(this).addClass("current");
		$(this).siblings().removeClass('current');
		//获取锚点
		var local = location.hash.split("#", 2)[1];
		window.location.href = location.hash.split("#", 2)[0] + '#' + id;
		$("#tab1,#tab2").attr("class", "tab-pane");
		$("#" + id).attr("class", "tab-pane in");
	});
});
</script>
</block>