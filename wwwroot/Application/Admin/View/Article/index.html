<extend name="Public/base"/>

<!-- 子导航 -->
<block name="sidebar">
    <div id="subnav" class="subnav">
        <volist name="nodes" id="sub_menu">
            <!-- 子导航 -->
            <notempty name="sub_menu">
                <h3><i class="icon-fold"></i><a href="{$sub_menu.url|U}">{$sub_menu.title}</a></h3>
                <ul <neq name="sub_menu['current']" value="1">class="subnav-off"</neq>>
                    <volist name="sub_menu['_child']" id="menu">
                        <li <if condition="$menu['id'] eq $cate_id or $menu['current'] eq 1">class="current"</if>><a href="{$menu.url|U}">{$menu.title}</a></li>
                    </volist>
                </ul>
            </notempty>
            <!-- /子导航 -->
        </volist>
    </div>
</block>


<block name="body">
	<!-- 标题 -->
	<div class="main-title">
		<h2>文档列表</h2>
	</div>

	<!-- 标签页导航 -->
	<div class="tab-wrap">
		<notempty name="child_cates">
		<ul class="tab-nav nav">
			<volist name="child_cates" id="child_cate">
				<li <eq name="child_cate['id']" value="$cate_id">class="current"</eq>><a data-tab="tab" href="{$child_cate.url|U}">{$child_cate.title}</a></li>
			</volist>
		</ul>
		</notempty>
		<div class="tab-content">
			<!-- 标签一内容 -->
			<div id="tag1" class="tab-pane in">
				<!-- 操作按钮区 -->
				<div class="cf">
					<div class="fl">
						<button class="btn" id="document_add" url="{:U('article/add',array('cate_id'=>$cate_id,'model_id'=>$model[0]))}">
							<i class="icon-add"></i>新增
						</button>
						<button class="btn" name="document_operate" status="-1">
							<i class="icon-delete"></i>删除
						</button>
						<button class="btn" name="document_operate" status="1">
							<i class="icon-right"></i>启用
						</button>
						<button class="btn" name="document_operate" status="0">
							<i class="icon-denied"></i>禁用
						</button>
					</div>

					<div class="tools fr">
						<form method="get" class="search-form">
							<input type="text" name="search" class="text" placeholder="请输入关键字" value="{$search}">
							<select name="status">
								<option value="">所有状态</option>
								<option value="1" <eq name="status" value="1">selected="selected"</eq>>启用</option>
								<option value="0" <heq name="status" value="0">selected="selected"</heq>>禁用</option>
								<option value="2" <eq name="status" value="2">selected="selected"</eq>>待审核</option>
							</select>
							<input type="button" value="查询" class="btn" id="search" url="{:U('article/index','cate_id='.$cate_id,false)}">
						</form>
					</div>
				</div>

				<!-- 数据列表 -->
				<div class="data-table">
					<table>
						<thead>
							<tr>
								<th class="row-selected"><input type="checkbox" id="selectall"/></th>
								<th>标题</th>
								<th>创建者</th>
								<th>创建时间</th>
								<th>状态</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<volist name="list" id="vo">
							<tr>
								<td><input type="checkbox" value="{$vo.id}" class="child_checkbox"/></td>
								<td><a href="{:U('edit',array('id'=>$vo['id'],'cate_id'=>$cate_id))}">{$vo.title}</a></td>
								<td>{$vo.uid|get_username}</td>
								<td>{$vo.create_time|time_format}</td>
								<td>{$vo.status|get_status_title}</td>
								<td>
									<a href="{:U('edit',array('id'=>$vo['id'],'cate_id'=>$cate_id))}">编辑</a>
									<a href="{:U('setStatus',array('ids'=>$vo['id'],'status'=>-1))}">删除</a>
									<eq name="vo['status']" value="0">
										<a href="{:U('setStatus',array('ids'=>$vo['id'],'status'=>1))}">启用</a>
									</eq>
									<eq name="vo['status']" value="1">
										<a href="{:U('setStatus',array('ids'=>$vo['id'],'status'=>0))}">禁用</a>
									</eq>
									<eq name="vo['status']" value="2">
										<a href="{:U('setStatus',array('ids'=>$vo['id'],'status'=>1))}">审核</a>
									</eq>
								</td>
							</tr>
							</volist>
						</tbody>
					</table>
				</div>

				<!-- 分页 -->
				<div class="page">{$page}</div>
			</div>
		</div>
	</div>



</block>
<block name="script">
<script type="text/javascript">
$(function(){
	$("#search").click(function(){
		var url = $(this).attr('url');
		var status = $('select[name=status]').val();
		var search = $('input[name=search]').val();
		if(status != ''){
			url += '/status/' + status;
		}
		if(search != ''){
			url += '/search/' + encodeURIComponent(search);
		}
		window.location.href = url;
	});
	$("#document_add").click(function(){
		window.location.href = $(this).attr('url');
	})
	$("button[name=document_operate]").click(function(){
		var status = $(this).attr('status');
		//获取选中的数据
		var checked = $('input:checked');
		var ids = new Array();
		checked.each(function(i){
			var id = $(this).val();
			if(id != 'on'){
				ids[ids.length] = id;
			}
		});
		if(ids.length == 0){
			alert('请选择要操作的数据！');
			return false;
		}
		//进行ajax操作
		$.post(
			"{:U('setStatus')}",
			{
				'ids' : ids,
				'status' : status
			},
			function(data){
				if(data.status == 1){
					alert('设置成功！');
					setTimeout(function(){window.location.reload()},1500);
				}else{
					alert('操作失败！');
				}
			},
			'json'
		);
	});
})
</script>
</block>