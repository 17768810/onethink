<!-- 管理员用户组新增和编辑页面 -->
<extend name="Public/base" />
<block name="body">
    <div class="main-title cf">
        <h2>访问授权</h2>
    </div>
    <form action="{:U('AuthManager/writeGroup')}" enctype="application/x-www-form-urlencoded" method="POST" 
            class="form-horizontal auth-form">
        <div id="node_list">
            <volist name="node_list" id="node" >
                <div class="form-item rules_row">
                    <label class="item-label" style="font-weight:bold;">{$node.title}管理：</label>
                    <div class="controls">
                        <span style="display:inline-block;vertical-align:top;">
                            <label class="checkbox"><input type="checkbox" class="rules_all" />全选</label>
                        </span>
                        <span style="display:inline-block;">
                            <span style="font-weight:bold;">
                                <label class="checkbox" <notempty name="node['tip']">title='{$node.tip}'</notempty>>
                                <!-- 主节点 -->
                                <input class="auth_rules" type="checkbox" name="rules[]"
                                       value="<?php echo $main_rules[$node['url']] ?>"/>{$node.title}
                                   </label>
                               </span>

                               <!-- 子节点列表 -->
                               <volist name="node['child']" id="child" >
                               <div>
                                   <label class="checkbox" <notempty name="child['tip']">title='{$child.tip}'</notempty>>
                                       <input class="auth_rules" type="checkbox" name="rules[]" 
                                       value="<?php echo $auth_rules[$child['url']] ?>"/>{$child.title}
                                   </label>
                                   <notempty name="child['operator']">
                                   <span>&nbsp;-&nbsp;</span>
                                   <span>
                                       <volist name="child['operator']" id="op">
                                       <label class="checkbox" <notempty name="op['tip']">title='{$op.tip}'</notempty>>
                                           <input class="auth_rules" type="checkbox" name="rules[]" 
                                           value="<?php echo $auth_rules[$op['url']] ?>"/>{$op.title}
                                       </label>
                                       </volist>
                                   </span>
                                   </notempty>
                               </div>
                               </volist>
                        </span>
                    </div>
                </div>
            </volist>
        </div>
        <div class="form-item">
            <label class="item-label"></label>
            <div class="controls">
                <input type="hidden" name="id" value="{$auth_group.id}" />
                <input type="submit" class="btn" value="保存" />
            </div>
        </div>
    </form>
</block>
<block name="script">
<script type="text/javascript" charset="utf-8">
    +function($){
        var rules = [{$auth_group.rules}];
        $('.auth_rules').each(function(){
            if( $.inArray( parseInt(this.value,10),rules )>-1 ){
                $(this).prop('checked',true);
            }
            if(this.value==''){
                $(this).closest('span').remove();
            }
        });

        //全选节点
        $('.rules_all').on('change',function(){
            $(this).parents('.rules_row').find('input').prop('checked',this.checked);
        });
    }(jQuery);
</script>
</block>
